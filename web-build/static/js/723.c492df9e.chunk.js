"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[723],{723:(e,t,a)=>{a.r(t),a.d(t,{default:()=>m});var n=a(665),c=a(391),o=a(538),r=a(400),l=a(906),i=a(696);const s=new class{watchId=null;async getCurrentLocation(){return new Promise(((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition((t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:new Date(t.timestamp)})}),(e=>{t(e)})):t(new Error("\u0413\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u044f \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f"))}))}watchLocation(e,t){navigator.geolocation?this.watchId=navigator.geolocation.watchPosition((t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:new Date(t.timestamp)})}),(e=>{t?.(new Error(e.message))}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):t?.(new Error("\u0413\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u044f \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f"))}stopWatching(){null!==this.watchId&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null)}async updateUserLocation(e){await i.default.post("/users/location",e)}async getNearbyUsers(e){return(await i.default.get(`/users/nearby?radius=${e}`)).data}};var u=a(195);const m=()=>{const[e,t]=(0,n.useState)(null),[a,i]=(0,n.useState)([]),[m,d]=(0,n.useState)(!0),[h,p]=(0,n.useState)(""),[g,E]=(0,n.useState)(!1),{user:w}=(0,u.useAuth)();(0,n.useEffect)((()=>(y(),()=>{g&&s.stopWatching()})),[]);const y=async()=>{try{d(!0);const e=await s.getCurrentLocation();t(e),await v()}catch(e){p("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f")}finally{d(!1)}},v=async()=>{if(e)try{const t=(await s.getNearbyUsers(5)).map((t=>({id:t.id,name:t.name||"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c",location:t.location,distance:N(e.latitude,e.longitude,t.location.latitude,t.location.longitude)})));i(t)}catch(t){p("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0431\u043b\u0438\u0436\u0430\u0439\u0448\u0438\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439")}},N=(e,t,a,n)=>{const c=b(a-e),o=b(n-t),r=Math.sin(c/2)*Math.sin(c/2)+Math.cos(b(e))*Math.cos(b(a))*Math.sin(o/2)*Math.sin(o/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},b=e=>e*Math.PI/180;return m?n.createElement("div",{className:"loading"},"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."):h?n.createElement("div",{className:"error"},h):e?n.createElement("div",{className:"location-screen"},n.createElement("div",{className:"location-controls"},n.createElement("button",{onClick:()=>{g?(s.stopWatching(),E(!1)):(s.watchLocation((e=>{t(e),v()}),(e=>{p("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0438 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f")})),E(!0))},className:"watch-button "+(g?"active":"")},g?"\u041e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0435":"\u041d\u0430\u0447\u0430\u0442\u044c \u043e\u0442\u0441\u043b\u0435\u0436\u0438\u0432\u0430\u043d\u0438\u0435"),n.createElement("button",{onClick:async()=>{if(e)try{await s.updateUserLocation(e)}catch(t){p("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0438 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044f")}},className:"update-button"},"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435")),n.createElement("div",{className:"map-container"},n.createElement(c.MapContainer,{center:[e.latitude,e.longitude],zoom:13,style:{height:"500px",width:"100%"}},n.createElement(o.TileLayer,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),n.createElement(r.Marker,{position:[e.latitude,e.longitude]},n.createElement(l.Popup,null,n.createElement("div",{className:"marker-popup"},n.createElement("h3",null,"\u0412\u044b"),n.createElement("p",null,"\u0412\u0430\u0448\u0435 \u0442\u0435\u043a\u0443\u0449\u0435\u0435 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435")))),a.map((e=>n.createElement(r.Marker,{key:e.id,position:[e.location.latitude,e.location.longitude]},n.createElement(l.Popup,null,n.createElement("div",{className:"marker-popup"},n.createElement("h3",null,e.name),n.createElement("p",null,"\u0420\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435: ",e.distance.toFixed(2)," \u043a\u043c")))))))),n.createElement("div",{className:"nearby-users"},n.createElement("h2",null,"\u0411\u043b\u0438\u0436\u0430\u0439\u0448\u0438\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"),n.createElement("div",{className:"users-list"},a.map((e=>n.createElement("div",{key:e.id,className:"user-card"},n.createElement("h3",null,e.name),n.createElement("p",null,"\u0420\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435: ",e.distance.toFixed(2)," \u043a\u043c"))))))):n.createElement("div",{className:"location-screen"},n.createElement("div",{className:"location-error"},n.createElement("h2",null,"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435"),n.createElement("p",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0440\u0430\u0437\u0440\u0435\u0448\u0438\u0442\u0435 \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u0433\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u0438 \u0432 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430\u0445 \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430")))}}}]);
//# sourceMappingURL=723.c492df9e.chunk.js.map